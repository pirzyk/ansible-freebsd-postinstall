- name: "Create {{ nfs_services_path }}"
  ansible.builtin.copy:
    dest: "{{ nfs_services_path }}"
    mode: "0664"
    backup: true
    content: |
      ---
      # Generated by .configure.yml

      fp_nfs_services_enable:
      {% for service, var in nfs_services.items() %}
        - label: "nfs: Enable and start {{ service }}"
          conf: "{{ _start }} fp_{{ var }}_enable_rcconf {{ _stop }}"
          when: "{{ _start }} fp_{{ var }}_enable | bool {{ _stop }}"
          notify: "{{ _start }} fp_nfs_handlers.{{ service }} {{ _stop }}"
      {% endfor %}

      fp_nfs_services_disable:
      {% for service, var in nfs_services.items() %}
        - label: "nfs: Disable and stop {{ service }}"
          conf: "{{ _start }} fp_{{ var }}_disable_rcconf {{ _stop }}"
          when: "{{ _start }} not fp_{{ var }}_enable | bool {{ _stop }}"
          notify: disable and stop {{ service }}
      {% endfor %}
