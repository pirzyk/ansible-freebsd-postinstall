- name: "Create {{ nfsd_services_path }}"
  ansible.builtin.copy:
    dest: "{{ nfsd_services_path }}"
    mode: "0664"
    backup: true
    content: |
      ---
      # Generated by .configure.yml

      fp_nfsd_services_enable:
      {% for service, var in nfsd_services.items() %}
        - label: "nfsd: Enable and start {{ service }}"
          conf: "{{ _start }} fp_{{ var }}_enable_rcconf {{ _stop }}"
          when: "{{ _start }} fp_{{ var }}_enable | bool {{ _stop }}"
          notify: "{{ _start }} fp_nfsd_handlers.{{ service }} {{ _stop }}"
      {% endfor %}

      fp_nfsd_services_disable:
      {% for service, var in nfsd_services.items() %}
        - label: "nfsd: Disable and stop {{ service }}"
          conf: "{{ _start }} fp_{{ var }}_disable_rcconf {{ _stop }}"
          when: "{{ _start }} not fp_{{ var }}_enable | bool {{ _stop }}"
          notify: disable and stop {{ service }}
      {% endfor %}
